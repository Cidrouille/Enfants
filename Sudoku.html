<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Sudoku</title>
<link rel="stylesheet" href="Sudoku.css">
</head>
<body>

<div class="background">
    <!-- Bulles -->
    <span class="bubble" style="--size:30px; --left:10%; --duration:12s;"></span>
    <span class="bubble" style="--size:50px; --left:70%; --duration:15s;"></span>
    <span class="bubble" style="--size:40px; --left:40%; --duration:18s;"></span>
    <span class="bubble" style="--size:25px; --left:80%; --duration:10s;"></span>

    <!-- LumiÃ¨res -->
    <span class="lights" style="--size:12px; --left:15%; --duration:8s;"></span>
    <span class="lights" style="--size:10px; --left:45%; --duration:10s;"></span>
    <span class="lights" style="--size:14px; --left:70%; --duration:12s;"></span>
	
	<!-- Etoiles -->
	<span class="star" style="--size:18px; --left:15%; --duration:12s;"></span>
    <span class="star" style="--size:12px; --left:45%; --duration:8s;"></span>
	<span class="star" style="--size:25px; --left:85%; --duration:10s;"></span>
	
	<!-- Lunes -->
	<span class="lune" style="--size:18px; --left:20%; --duration:10s;"></span>
    <span class="lune" style="--size:12px; --left:50%; --duration:15s;"></span>
	<span class="lune" style="--size:25px; --left:90%; --duration:13s;"></span>
	
	<div class="shooting-star" style="--size:25px; --duration:5s; --start-left:0vw; --start-bottom:65%;">
	  <div class="trail"></div>
	  <div class="star-shape"></div>
	</div>
	<div class="shooting-star" style="--size:25px; --duration:6s; --start-left:0vw; --start-bottom:10%;">
	  <div class="trail"></div>
	  <div class="star-shape"></div>
	</div>
	<div class="shooting-star" style="--size:25px; --duration:7s; --start-left:50vw; --start-bottom:0%;">
	  <div class="trail"></div>
	  <div class="star-shape"></div>
	</div>
	
	<div id="cursor-trail"></div>
</div>

<header>
    <div class="header-left">
        <button id="goHomeBtn">Changer de jeu</button>
    </div>
    <h1>ðŸ§© Sudoku</h1>
</header>

<!-- Boutons de difficultÃ© -->
<div class="difficulty">
    <button class="diff-btn" data-diff="facile">Facile</button>
    <button class="diff-btn" data-diff="moyen">Moyen</button>
    <button class="diff-btn" data-diff="difficile">Difficile</button>
</div>

<main>
    <div id="sudoku" class="sudoku-container"></div>

    <div class="controls">
        <button onclick="checkSudoku()">VÃ©rifier</button>
        <button onclick="generateNewGame()">Nouvelle grille</button>
    </div>

    <p id="message"></p>
</main>

<script>
const container = document.getElementById("sudoku");
let solution = [];
let puzzle = [];

// DifficultÃ© par dÃ©faut
let currentDifficulty = "facile";

// Mapping nombre de cases Ã  retirer
const difficultyMap = {
    "facile": 30,
    "moyen": 40,
    "difficile": 50
};

/* ==================== */
/* FONCTIONS SUDOKU */
/* ==================== */
function shuffle(array){
    return array.sort(()=>Math.random()-0.5);
}

function isValid(grid,row,col,num){
    for(let x=0;x<9;x++){
        if(grid[row][x]==num || grid[x][col]==num) return false;
    }
    let startRow=row-row%3;
    let startCol=col-col%3;
    for(let i=0;i<3;i++){
        for(let j=0;j<3;j++){
            if(grid[i+startRow][j+startCol]==num) return false;
        }
    }
    return true;
}

function solve(grid){
    for(let row=0;row<9;row++){
        for(let col=0;col<9;col++){
            if(grid[row][col]==0){
                let numbers=shuffle([1,2,3,4,5,6,7,8,9]);
                for(let num of numbers){
                    if(isValid(grid,row,col,num)){
                        grid[row][col]=num;
                        if(solve(grid)) return true;
                        grid[row][col]=0;
                    }
                }
                return false;
            }
        }
    }
    return true;
}

// GÃ©nÃ©ration d'une grille selon la difficultÃ©
function generateSudoku(){
    let grid=Array.from({length:9},()=>Array(9).fill(0));
    solve(grid);
    solution = grid.map(r=>[...r]);
    puzzle = grid.map(r=>[...r]);

    let attempts = difficultyMap[currentDifficulty];
    while(attempts>0){
        let row = Math.floor(Math.random()*9);
        let col = Math.floor(Math.random()*9);
        if(puzzle[row][col] != 0){
            puzzle[row][col] = 0;
            attempts--;
        }
    }
}

/* ==================== */
/* AFFICHAGE GRILLE */
/* ==================== */
function drawGrid(){
    container.innerHTML="";
    for(let r=0;r<9;r++){
        for(let c=0;c<9;c++){
            const input=document.createElement("input");
            input.type="number";
            input.min=1;
            input.max=9;
            input.classList.add("cell");

            if(puzzle[r][c]!=0){
                input.value=puzzle[r][c];
                input.disabled=true;
                input.classList.add("fixed");
            }

            input.dataset.row=r;
            input.dataset.col=c;

            container.appendChild(input);
        }
    }
}

/* ==================== */
/* CHECK SUDOKU */
/* ==================== */
function checkSudoku(){
    let correct=true;
    document.querySelectorAll(".cell").forEach(cell=>{
        let r=cell.dataset.row;
        let c=cell.dataset.col;

        if(!cell.disabled){
            if(parseInt(cell.value)==solution[r][c]){
                cell.style.background="#69db7c";
            } else {
                cell.style.background="#ff6b6b";
                correct=false;
            }
        }
    });

    document.getElementById("message").textContent=
        correct ? "ðŸŽ‰ Bravo ! Sudoku correct !" : "âŒ Il y a des erreurs.";
}

/* ==================== */
/* NOUVELLE GRILLE */
// Utilise currentDifficulty
function generateNewGame(){
    generateSudoku();
    drawGrid();
    document.getElementById("message").textContent = 
        `DifficultÃ© actuelle : ${currentDifficulty.toUpperCase()}`;
}

/* ==================== */
/* BOUTONS DIFFICULTÃ‰ */
document.querySelectorAll(".diff-btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
        currentDifficulty = btn.dataset.diff;
        generateNewGame();
    });
});

/* ==================== */
/* INIT */
generateNewGame();

goHomeBtn.onclick = () => {
    window.location.href = "Accueil.html";
};

</script>

</body>
</html>
